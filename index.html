import gradio as gr
from groq import Groq
import os
from getpass import getpass

# ðŸ”‘ Set your Groq API key here or use an environment variable
GROQ_TOKEN = getpass("Enter your GROQ token:")
os.environ["GROQ_TOKEN"] = GROQ_TOKEN

# Initialize Groq client
client = Groq(api_key=GROQ_API_KEY)

# Supported models (update as more models become available)
AVAILABLE_MODELS = ["Llama-3.3-70b-versatile", "mixtral-8x7b-32768","groq/compound","openai/gpt-oss-20b","whisper-large-v3-turbo","playai-tts	"]

# Chat function
def chat_with_ai(model_name, message, chat_history):
    if not message.strip():
        return chat_history, "Please enter a message."

    # Prepare conversation history
    messages = [{"role": "system", "content": "You are a helpful AI assistant."}]
    for user_msg, ai_msg in chat_history:
        messages.append({"role": "user", "content": user_msg})
        messages.append({"role": "assistant", "content": ai_msg})
    messages.append({"role": "user", "content": message})

    try:
        response = client.chat.completions.create(
            model=model_name,
            messages=messages,
        )
        reply = response.choices[0].message.content
        chat_history.append((message, reply))
        return chat_history, ""
    except Exception as e:
        return chat_history, f"Error: {str(e)}"

# Gradio UI
with gr.Blocks() as demo:
    gr.Markdown("# ðŸ¤– BOOMER CHATBOT")

    with gr.Row():
        model_selector = gr.Dropdown(choices=AVAILABLE_MODELS, value=AVAILABLE_MODELS[0], label="Select AI Model")

    chatbot = gr.Chatbot(label="Chat with AI")
    user_input = gr.Textbox(placeholder="Type your message...", label="Your Message")
    error_box = gr.Textbox(label="Status", interactive=False)
    clear_btn = gr.Button("Clear Chat")

    state = gr.State([])  # Chat history

    def handle_submit(message, history, model_name):
        return chat_with_ai(model_name, message, history)

    user_input.submit(fn=handle_submit, inputs=[user_input, state, model_selector], outputs=[chatbot, error_box])
    clear_btn.click(lambda: ([], ""), outputs=[chatbot, error_box, state])

# Launch the app
demo.launch()
